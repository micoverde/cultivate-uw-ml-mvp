name: Code Review Checklist

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  code-review-checklist:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write

    steps:
      - name: Post Code Review Checklist
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prNumber = context.payload.pull_request.number;
            const checklist = `## ðŸ“‹ Code Review Checklist

            ### Architecture & Design
            - [ ] Follows established patterns in codebase
            - [ ] Solution is appropriate for the problem
            - [ ] No scalability concerns
            - [ ] Maintainable code

            ### Code Quality
            - [ ] No obvious bugs or edge cases
            - [ ] Error handling is appropriate
            - [ ] Code is clear and readable
            - [ ] No unnecessary complexity

            ### Security
            - [ ] No security vulnerabilities
            - [ ] Credentials/sensitive data handled correctly
            - [ ] Authentication/authorization proper
            - [ ] Input validation present

            ### Testing
            - [ ] Test coverage is adequate
            - [ ] Edge cases are covered
            - [ ] Tests are meaningful
            - [ ] No test regressions

            ### Performance
            - [ ] No performance regressions
            - [ ] Database queries optimized (if applicable)
            - [ ] Frontend bundle size acceptable
            - [ ] Caching strategies considered

            ### Documentation
            - [ ] Changes are documented
            - [ ] Commit messages are clear
            - [ ] API documentation updated (if applicable)
            - [ ] Comments explain complex logic

            ---
            **To request a detailed Claude Code review, comment:** \`@claude\``;

            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: checklist
            });

      - name: Add Review Labels
        uses: actions/github-script@v7
        if: always()
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prNumber = context.payload.pull_request.number;
            try {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                labels: ['needs-review']
              });
            } catch (err) {
              console.log('Could not add label');
            }
