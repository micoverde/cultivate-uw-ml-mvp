<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo 1 - ECE Question Classification | Cultivate Learning</title>

    <!-- Unified Design System -->
    <link rel="stylesheet" href="../shared/unified-styles.css">

    <!-- Page Specific Styles -->
    <style>
        /* Demo 1 Specific Styles */
        .classification-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-top: var(--space-md);
        }

        .classification-label {
            font-weight: 600;
            font-size: var(--font-lg);
        }

        .classification-label.oeq {
            color: var(--success);
        }

        .classification-label.ceq {
            color: var(--info);
        }

        .confidence-meter {
            flex: 1;
            margin: 0 var(--space-lg);
            height: 8px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: var(--brand-primary);
            transition: width var(--transition-base);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .metric-card {
            background: var(--bg-tertiary);
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            text-align: center;
        }

        .metric-value {
            font-size: var(--font-2xl);
            font-weight: 700;
            color: var(--brand-primary);
            margin-bottom: var(--space-xs);
        }

        .metric-label {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-md);
        }

        .scenario-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .scenario-card:hover {
            border-color: var(--brand-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .scenario-title {
            font-weight: 600;
            margin-bottom: var(--space-sm);
        }

        .scenario-question {
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: var(--space-sm);
        }

        .scenario-context {
            font-size: var(--font-sm);
            color: var(--text-tertiary);
        }

        .loading-spinner {
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--brand-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: var(--space-lg) auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn var(--transition-base);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Unified Header will be injected here -->

    <div class="unified-container">
        <div class="unified-card">
            <div class="card-header">
                <h2 class="card-title">ECE Question Classification System</h2>
                <p class="card-description">AI-powered assessment tool for early childhood education questioning techniques</p>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="showTab('demo')">Live Demo</button>
                <button class="tab-btn" onclick="showTab('scenarios')">Child Scenarios</button>
                <button class="tab-btn" onclick="showTab('metrics')">Performance Metrics</button>
            </div>

            <!-- Live Demo Tab -->
            <div id="demo" class="tab-content active">
                <div class="input-group">
                    <label class="input-label" for="questionInput">Enter your educational question</label>
                    <textarea
                        id="questionInput"
                        class="textarea"
                        placeholder="Type a question you might ask young children..."
                        rows="4"></textarea>
                </div>

                <button class="btn" onclick="analyzeQuestion()">Analyze Question</button>

                <div id="resultContainer" style="display: none;">
                    <div class="classification-result">
                        <span class="classification-label" id="classificationLabel">--</span>
                        <div class="confidence-meter">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <span id="confidenceValue">--</span>
                    </div>

                    <div class="unified-card mt-lg" id="explanationCard" style="display: none;">
                        <h3 class="card-title">Analysis Details</h3>
                        <div id="explanationContent"></div>
                    </div>
                </div>
            </div>

            <!-- Child Scenarios Tab -->
            <div id="scenarios" class="tab-content">
                <p class="mb-md">Select a scenario to see how the AI classifies different types of educational questions in context.</p>
                <div class="scenario-grid" id="scenarioGrid">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>

            <!-- Performance Metrics Tab -->
            <div id="metrics" class="tab-content">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="totalAnalyzed">0</div>
                        <div class="metric-label">Questions Analyzed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgConfidence">0%</div>
                        <div class="metric-label">Avg Confidence</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="oeqRatio">0%</div>
                        <div class="metric-label">Open-Ended Ratio</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="responseTime">0ms</div>
                        <div class="metric-label">Avg Response Time</div>
                    </div>
                </div>

                <div class="unified-card mt-lg">
                    <h3 class="card-title">Model Performance</h3>
                    <p class="card-description">Real-time metrics from the ML classification system</p>
                    <div id="performanceChart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Unified Components -->
    <script src="../shared/unified-header.js"></script>
    <script src="../shared/footer.js"></script>
    <script src="../shared/model-settings.js"></script>

    <!-- Demo Functionality -->
    <script>
        // Core Demo 1 Functionality
        let metrics = {
            totalAnalyzed: 0,
            totalConfidence: 0,
            oeqCount: 0,
            totalResponseTime: 0
        };

        // Child scenarios data
        const scenarios = [
            {
                title: "Story Time Discussion",
                question: "What do you think will happen next in the story?",
                context: "During circle time, encouraging prediction skills"
            },
            {
                title: "Art Exploration",
                question: "Tell me about your painting",
                context: "Open-ended exploration of creative expression"
            },
            {
                title: "Math Concepts",
                question: "How many blocks are in this tower?",
                context: "Introducing counting and numerical concepts"
            },
            {
                title: "Science Discovery",
                question: "Why do you think the ice melted?",
                context: "Exploring cause and effect relationships"
            },
            {
                title: "Color Recognition",
                question: "Is this crayon red or blue?",
                context: "Binary choice for color identification"
            },
            {
                title: "Social Skills",
                question: "How did that make you feel?",
                context: "Emotional awareness and expression"
            }
        ];

        // Tab switching
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');

            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Analyze question
        async function analyzeQuestion() {
            const input = document.getElementById('questionInput').value.trim();

            if (!input) {
                alert('Please enter a question to analyze');
                return;
            }

            const startTime = performance.now();

            // Show loading state
            document.getElementById('resultContainer').style.display = 'block';
            document.getElementById('classificationLabel').textContent = 'Analyzing...';
            document.getElementById('confidenceValue').textContent = '--';
            document.getElementById('confidenceFill').style.width = '0%';

            try {
                // Get API endpoint from model settings
                const endpoint = window.modelSettings ?
                    window.modelSettings.getModelEndpoint() :
                    'http://localhost:8001/api/classify';

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: input,
                        debug_mode: true
                    })
                });

                if (!response.ok) throw new Error('API request failed');

                const data = await response.json();
                const endTime = performance.now();

                // Update UI with results
                const isOEQ = data.classification === 'OEQ';
                const confidence = Math.round(data.confidence * 100);

                document.getElementById('classificationLabel').textContent =
                    isOEQ ? 'Open-Ended Question' : 'Closed-Ended Question';
                document.getElementById('classificationLabel').className =
                    `classification-label ${isOEQ ? 'oeq' : 'ceq'}`;
                document.getElementById('confidenceValue').textContent = `${confidence}%`;
                document.getElementById('confidenceFill').style.width = `${confidence}%`;

                // Show explanation if available
                if (data.reasoning) {
                    document.getElementById('explanationCard').style.display = 'block';
                    document.getElementById('explanationContent').innerHTML = `
                        <p><strong>Reasoning:</strong> ${data.reasoning}</p>
                        ${data.features_extracted ? `<p><strong>Features Analyzed:</strong> ${data.features_extracted}</p>` : ''}
                        ${data.method ? `<p><strong>Model Used:</strong> ${data.method}</p>` : ''}
                    `;
                }

                // Update metrics
                updateMetrics(isOEQ, confidence, endTime - startTime);

            } catch (error) {
                console.error('Error analyzing question:', error);
                alert('Error analyzing question. Please ensure the ML API is running.');
            }
        }

        // Update performance metrics
        function updateMetrics(isOEQ, confidence, responseTime) {
            metrics.totalAnalyzed++;
            metrics.totalConfidence += confidence;
            if (isOEQ) metrics.oeqCount++;
            metrics.totalResponseTime += responseTime;

            document.getElementById('totalAnalyzed').textContent = metrics.totalAnalyzed;
            document.getElementById('avgConfidence').textContent =
                Math.round(metrics.totalConfidence / metrics.totalAnalyzed) + '%';
            document.getElementById('oeqRatio').textContent =
                Math.round((metrics.oeqCount / metrics.totalAnalyzed) * 100) + '%';
            document.getElementById('responseTime').textContent =
                Math.round(metrics.totalResponseTime / metrics.totalAnalyzed) + 'ms';
        }

        // Load scenarios
        function loadScenarios() {
            const grid = document.getElementById('scenarioGrid');
            grid.innerHTML = scenarios.map(scenario => `
                <div class="scenario-card" onclick="analyzeScenario('${scenario.question.replace(/'/g, "\\'")}')">
                    <div class="scenario-title">${scenario.title}</div>
                    <div class="scenario-question">"${scenario.question}"</div>
                    <div class="scenario-context">${scenario.context}</div>
                </div>
            `).join('');
        }

        // Analyze scenario
        function analyzeScenario(question) {
            document.getElementById('questionInput').value = question;
            showTab('demo');
            analyzeQuestion();
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadScenarios();

            // Enter key to analyze
            document.getElementById('questionInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    analyzeQuestion();
                }
            });
        });
    </script>
</body>
</html>