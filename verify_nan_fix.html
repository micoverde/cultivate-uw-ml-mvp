<!DOCTYPE html>
<html>
<head>
    <title>Verify NaN Fix</title>
</head>
<body>
    <h1>Testing NaN% Fix in Production</h1>
    <button onclick="testDemo1()">Test Demo1 API</button>
    <button onclick="testDemo2()">Test Demo2 API</button>
    <div id="result"></div>

    <script>
        async function testDemo1() {
            const apiBase = 'https://cultivate-ml-api.ashysky-fe559536.eastus.azurecontainerapps.io';
            const text = 'What happened to make you feel that way?';

            document.getElementById('result').innerHTML = '<p>Testing Demo1...</p>';

            try {
                const response = await fetch(`${apiBase}/api/classify?text=${encodeURIComponent(text)}`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                // Check if probabilities exist or are being normalized
                const hasOeqProb = result.oeq_probability !== undefined;
                const hasCeqProb = result.ceq_probability !== undefined;

                // Test the fix - should not show NaN
                const oeqPercent = Math.round((result.oeq_probability || 0) * 100);
                const ceqPercent = Math.round((result.ceq_probability || 0) * 100);

                document.getElementById('result').innerHTML = `
                    <h2>✅ Demo1 Test Results</h2>
                    <p>Raw Response:</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                    <p>Has oeq_probability: ${hasOeqProb}</p>
                    <p>Has ceq_probability: ${hasCeqProb}</p>
                    <p>OEQ Display: ${oeqPercent}% (${isNaN(oeqPercent) ? '❌ NaN!' : '✅ OK'})</p>
                    <p>CEQ Display: ${ceqPercent}% (${isNaN(ceqPercent) ? '❌ NaN!' : '✅ OK'})</p>
                `;
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <h2>❌ Error</h2>
                    <pre>${error.message}</pre>
                `;
            }
        }

        async function testDemo2() {
            // Demo2 uses same API endpoint
            testDemo1();
        }
    </script>
</body>
</html>